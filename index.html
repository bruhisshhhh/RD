<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dark Romance | Eternal Rose</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,600&family=Montserrat:wght@300;400;600;800&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">

    <!-- Theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'void': '#020101',
                        'wine': '#2b0a16',
                        'gold-dim': '#b45309',
                        'gold-bright': '#fbbf24',
                        'neon-blue': '#3b82f6',
                        'neon-red': '#f43f5e',
                    },
                    fontFamily: {
                        'title': ['"Cinzel"', 'serif'],
                        'body': ['"Playfair Display"', 'serif'],
                        'ui': ['"Montserrat"', 'sans-serif'],
                        'hand': ['"Dancing Script"', 'cursive'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-glow': 'pulseGlow 2s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        pulseGlow: {
                            '0%, 100%': { opacity: 1, boxShadow: '0 0 20px #fbbf24' },
                            '50%': { opacity: 0.8, boxShadow: '0 0 10px #fbbf24' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #020101; overflow-x: hidden; color: #e5e5e5; }
        
        /* Background */
        #bgCanvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at center, #1a0505 0%, #000000 100%);
        }

        /* Explosion Canvas */
        #explosionCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 60;
        }

        /* Layout */
        .section-container {
            min-height: 100vh;
            display: none;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            padding-bottom: 120px;
            position: relative;
        }
        .section-container.active { display: flex; opacity: 1; }

        /* Modern Glass Card */
        .glass {
            background: rgba(20, 10, 10, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px -10px rgba(0, 0, 0, 0.8);
        }

        /* --- HYPER MODERN BUTTONS --- */
        .btn-modern {
            background: transparent;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 16px 40px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            cursor: pointer;
            z-index: 100;
        }
        .btn-modern::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        .btn-modern:hover::before { transform: translateX(100%); }
        .btn-modern:hover {
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
            transform: scale(1.05);
            background: rgba(251, 191, 36, 0.1);
        }

        /* Sticky Footer */
        .sticky-footer {
            position: fixed; bottom: 30px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 50;
            pointer-events: none;
        }
        .sticky-footer button { pointer-events: auto; }

        /* --- FIRE POPUP (Liquid) --- */
        .popup-fire {
            background: #050000;
            border-radius: 20px;
            position: relative;
            z-index: 0;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.2);
            transform: scale(0.9); opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .popup-fire::before {
            content: ''; position: absolute; z-index: -2; left: -50%; top: -50%; width: 200%; height: 200%;
            background-color: #000;
            background-repeat: no-repeat;
            background-position: 0 0;
            background-image: conic-gradient(transparent, #f59e0b, #ef4444, transparent 30%);
            animation: rotate 4s linear infinite;
        }
        .popup-fire::after {
            content: ''; position: absolute; z-index: -1; left: 2px; top: 2px; width: calc(100% - 4px); height: calc(100% - 4px);
            background: #050000; border-radius: 18px;
        }
        .popup-fire.show { transform: scale(1); opacity: 1; }
        @keyframes rotate { 100% { transform: rotate(1turn); } }

        /* --- SKINNY LOCK --- */
        .skinny-lock {
            width: 34px; height: 50px;
            border: 2px solid #fbbf24;
            border-radius: 6px;
            position: relative;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
            transition: all 0.3s;
        }
        .skinny-lock::before { /* Shackle */
            content: ''; position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
            width: 22px; height: 35px;
            border-radius: 15px 15px 0 0;
            border: 2px solid #fbbf24;
            border-bottom: 0;
            transform-origin: 100% 100%;
            transition: transform 0.5s;
        }
        .unlocking .skinny-lock::before { transform: rotate(-45deg) translateY(-5px); }
        .unlocking { opacity: 0; transform: scale(1.5); }

        /* Gates */
        .gate-door { transition: transform 2.5s cubic-bezier(0.2, 0, 0.2, 1); }
        .gate-open .left-door { transform: perspective(1000px) rotateY(-100deg); }
        .gate-open .right-door { transform: perspective(1000px) rotateY(100deg); }

        /* Final Text Glow */
        .glow-text {
            text-shadow: 0 0 10px #e11d48, 0 0 20px #fbbf24;
            animation: textPulse 3s infinite alternate;
        }
        @keyframes textPulse { 0% { opacity: 0.8; } 100% { opacity: 1; text-shadow: 0 0 30px #e11d48; } }
    </style>
</head>
<body class="selection:bg-gold-bright selection:text-black">

    <canvas id="bgCanvas"></canvas>

    <!-- Save Button -->
    <div class="fixed top-5 right-5 z-50">
        <button onclick="captureCurrent()" class="text-[10px] uppercase tracking-widest text-white/40 border border-white/10 px-4 py-2 rounded-full hover:bg-white/10 hover:text-white transition-all backdrop-blur-md">
            Save Frame
        </button>
    </div>

    <!-- SECTION 1: HERO (Dark Romance Restored) -->
    <div id="section-hero" class="section-container active justify-center">
        <div class="text-center z-10 animate-float px-4">
            <p class="font-ui text-gold-dim tracking-[0.4em] text-xs font-bold mb-6 uppercase">Happy Rose Day</p>
            
            <h1 class="font-title text-6xl md:text-9xl font-black text-transparent bg-clip-text bg-gradient-to-b from-rose-800 to-black mb-0 drop-shadow-2xl leading-[0.8]">
                DARK
            </h1>
            <h1 class="font-title text-6xl md:text-9xl font-black text-transparent bg-clip-text bg-gradient-to-t from-rose-600 via-red-500 to-gold-bright mb-8 drop-shadow-[0_0_30px_rgba(225,29,72,0.4)] leading-[0.9]">
                ROMANCE
            </h1>
            
            <p class="font-ui text-gray-500 tracking-[0.6em] text-xs uppercase mb-16">
                The Eternal Rose Edition
            </p>
            
            <div class="border-l-4 border-rose-700 pl-8 text-left max-w-lg mx-auto">
                <p class="text-xl md:text-2xl text-white font-body italic leading-relaxed">
                    <!-- EDIT HERE -->
                    "Some loves are fleeting petals.<br>Ours is the whole damn garden."
                </p>
            </div>
        </div>
        
        <div class="sticky-footer">
            <button onclick="nextSection('section-hero', 'section-story')" class="btn-modern">
                Unfold The Story
            </button>
        </div>
    </div>

    <!-- SECTION 2: OUR STORY (5 Chapters + AutoScroll) -->
    <div id="section-story" class="section-container pt-24">
        <h2 class="font-title text-3xl md:text-4xl text-gold-bright mb-4 text-center">The Chapters of Us</h2>
        <p class="text-center text-xs text-gray-500 uppercase tracking-widest mb-20 font-ui font-bold">Five moments in time</p>
        
        <div class="w-full max-w-2xl space-y-24 relative pb-40 px-4">
            <!-- Line -->
            <div class="absolute left-6 md:left-1/2 top-0 bottom-0 w-px bg-white/10 md:-translate-x-1/2">
                <div id="timeline-progress" class="w-full bg-gold-bright transition-all duration-1000 shadow-[0_0_10px_#fbbf24]" style="height: 0%"></div>
            </div>

            <!-- Chapter 1 -->
            <div id="chap-1" class="relative pl-16 md:pl-0 md:flex md:justify-between items-center w-full transition-all duration-1000 opacity-0 translate-y-10">
                <div class="absolute left-6 md:left-1/2 w-3 h-3 bg-gold-bright rounded-full md:-translate-x-1/2 z-10 shadow-[0_0_20px_#fbbf24]"></div>
                <div class="md:w-[45%] md:ml-auto glass p-8 rounded-2xl border-l-2 border-gold-bright">
                    <span class="text-[10px] text-gold-bright font-bold tracking-[0.2em] uppercase font-ui">Chapter I</span>
                    <h3 class="text-xl text-white font-title my-2">The Spark</h3>
                    <p class="text-sm text-gray-400 font-ui leading-relaxed">
                        Remember when we first met? The way you laughed instantly changed the atmosphere of the room. It was electric.
                    </p>
                </div>
            </div>

            <!-- Chapter 2 -->
            <div id="chap-2" class="relative pl-16 md:pl-0 md:flex md:flex-row-reverse md:justify-between items-center w-full transition-all duration-1000 opacity-0 translate-y-10">
                <div class="absolute left-6 md:left-1/2 w-3 h-3 bg-rose-500 rounded-full md:-translate-x-1/2 z-10 shadow-[0_0_20px_#e11d48]"></div>
                <div class="md:w-[45%] md:mr-auto glass p-8 rounded-2xl border-r-2 border-rose-500 text-right">
                    <span class="text-[10px] text-rose-500 font-bold tracking-[0.2em] uppercase font-ui">Chapter II</span>
                    <h3 class="text-xl text-white font-title my-2">The Connection</h3>
                    <p class="text-sm text-gray-400 font-ui leading-relaxed">
                        Late night calls, songs we traded like secrets. I realized I didn't want to spend a day without talking to you.
                    </p>
                </div>
            </div>

            <!-- Chapter 3 -->
            <div id="chap-3" class="relative pl-16 md:pl-0 md:flex md:justify-between items-center w-full transition-all duration-1000 opacity-0 translate-y-10">
                <div class="absolute left-6 md:left-1/2 w-3 h-3 bg-purple-500 rounded-full md:-translate-x-1/2 z-10 shadow-[0_0_20px_#a855f7]"></div>
                <div class="md:w-[45%] md:ml-auto glass p-8 rounded-2xl border-l-2 border-purple-500">
                    <span class="text-[10px] text-purple-400 font-bold tracking-[0.2em] uppercase font-ui">Chapter III</span>
                    <h3 class="text-xl text-white font-title my-2">The Chaos</h3>
                    <p class="text-sm text-gray-400 font-ui leading-relaxed">
                        The inside jokes nobody else gets, the random adventures, and the beautiful mess we make together.
                    </p>
                </div>
            </div>

            <!-- Chapter 4 -->
            <div id="chap-4" class="relative pl-16 md:pl-0 md:flex md:flex-row-reverse md:justify-between items-center w-full transition-all duration-1000 opacity-0 translate-y-10">
                <div class="absolute left-6 md:left-1/2 w-3 h-3 bg-blue-500 rounded-full md:-translate-x-1/2 z-10 shadow-[0_0_20px_#3b82f6]"></div>
                <div class="md:w-[45%] md:mr-auto glass p-8 rounded-2xl border-r-2 border-blue-500 text-right">
                    <span class="text-[10px] text-blue-400 font-bold tracking-[0.2em] uppercase font-ui">Chapter IV</span>
                    <h3 class="text-xl text-white font-title my-2">The Peace</h3>
                    <p class="text-sm text-gray-400 font-ui leading-relaxed">
                        Finding comfort in silence. Knowing that no matter how hard the day was, you are my safe harbor.
                    </p>
                </div>
            </div>

            <!-- Chapter 5 -->
            <div id="chap-5" class="relative pl-16 md:pl-0 md:flex md:justify-between items-center w-full transition-all duration-1000 opacity-0 translate-y-10">
                <div class="absolute left-6 md:left-1/2 w-3 h-3 bg-white rounded-full md:-translate-x-1/2 z-10 shadow-[0_0_30px_#ffffff]"></div>
                <div class="md:w-[45%] md:ml-auto glass p-8 rounded-2xl border-l-2 border-white">
                    <span class="text-[10px] text-gray-200 font-bold tracking-[0.2em] uppercase font-ui">Now</span>
                    <h3 class="text-xl text-white font-title my-2">The Eternal</h3>
                    <p class="text-sm text-gray-400 font-ui leading-relaxed">
                        Here we are. Stronger, deeper, and more intense. You are my muse, my calm, and my storm.
                    </p>
                </div>
            </div>
        </div>

        <div class="sticky-footer">
            <button id="btn-next-story" onclick="revealNextChapter()" class="btn-modern">
                Next Chapter
            </button>
            <button id="btn-finish-story" onclick="nextSection('section-story', 'section-game')" class="btn-modern hidden">
                Enter The Garden
            </button>
        </div>
    </div>

    <!-- SECTION 3: FALLING PETALS (Liquid Fire Popup) -->
    <div id="section-game" class="section-container justify-center">
        <div class="text-center mb-8 z-10">
            <h2 class="font-title text-3xl md:text-4xl text-gold-bright mb-2 drop-shadow-lg">Catch 5 Falling Petals</h2>
            <p class="font-ui text-xs text-gray-400 uppercase tracking-widest font-bold">Tap the glowing energy</p>
        </div>

        <div class="relative glass rounded-[40px] overflow-hidden shadow-2xl border border-white/5" style="width: 100%; max-width: 800px; height: 500px;">
            <canvas id="gameCanvas" class="w-full h-full cursor-crosshair bg-black/60"></canvas>
            
            <div id="game-start-overlay" class="absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-20">
                <button onclick="startGame()" class="btn-modern">
                    Start Collecting
                </button>
            </div>

            <!-- FIRE MODAL (Liquid Animation) -->
            <div id="msg-modal" class="absolute inset-0 flex items-center justify-center bg-black/70 hidden z-30 p-6 backdrop-blur-md">
                <div id="modal-card" class="popup-fire p-8 max-w-sm text-center relative">
                    <div class="text-5xl mb-6 text-gold-bright drop-shadow-[0_0_20px_#f59e0b]">üî•</div>
                    <h3 class="font-ui text-white/50 text-[10px] tracking-[0.3em] uppercase mb-4 font-bold">Reason #<span id="msg-id">1</span></h3>
                    <p id="msg-content" class="font-body text-xl text-white italic mb-8 leading-relaxed">"..."</p>
                    <button onclick="closeModal()" class="text-gold-bright text-xs font-bold uppercase tracking-widest hover:text-white transition-colors border-b border-gold-bright pb-1">Next Spark ‚Üí</button>
                </div>
            </div>
            
            <div class="absolute top-8 right-8 font-title text-gold-bright text-2xl z-10 pointer-events-none">
                <span id="score">0</span> / 5
            </div>
        </div>

        <div id="game-next-btn" class="sticky-footer hidden opacity-0 transition-opacity duration-1000">
            <button onclick="nextSection('section-game', 'section-calc')" class="btn-modern">
                Check Vibe
            </button>
        </div>
    </div>

    <!-- SECTION 4: VIBE CALCULATOR (MOBILE OPTIMIZED) -->
    <div id="section-calc" class="section-container pt-24 justify-center">
        <h2 class="font-title text-3xl text-gold-bright mb-8 text-center">Compatibility Algorithm</h2>

        <!-- Compact Glass Card for Mobile -->
        <div class="glass p-6 md:p-14 rounded-[30px] border border-gold-dim/20 w-full max-w-5xl flex flex-col md:grid md:grid-cols-2 gap-8 items-center mb-24 px-6">
            
            <!-- Sliders -->
            <div class="space-y-6 w-full">
                <div class="group">
                    <div class="flex justify-between mb-1"><label class="font-ui text-gray-400 text-[9px] uppercase tracking-widest font-bold">Shared Laughter</label><span class="text-gold-bright font-mono text-xs" id="val-1">95%</span></div>
                    <input type="range" min="0" max="100" value="95" id="input-1" class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="group">
                    <div class="flex justify-between mb-1"><label class="font-ui text-gray-400 text-[9px] uppercase tracking-widest font-bold">Food Taste</label><span class="text-gold-bright font-mono text-xs" id="val-2">90%</span></div>
                    <input type="range" min="0" max="100" value="90" id="input-2" class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="group">
                    <div class="flex justify-between mb-1"><label class="font-ui text-gray-400 text-[9px] uppercase tracking-widest font-bold">Telepathy</label><span class="text-gold-bright font-mono text-xs" id="val-3">100%</span></div>
                    <input type="range" min="0" max="100" value="100" id="input-3" class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="group">
                    <div class="flex justify-between mb-1"><label class="font-ui text-gray-400 text-[9px] uppercase tracking-widest font-bold">Comfort in Silence</label><span class="text-gold-bright font-mono text-xs" id="val-4">98%</span></div>
                    <input type="range" min="0" max="100" value="98" id="input-4" class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="group">
                    <div class="flex justify-between mb-1"><label class="font-ui text-gray-400 text-[9px] uppercase tracking-widest font-bold">Chaotic Energy</label><span class="text-gold-bright font-mono text-xs" id="val-5">85%</span></div>
                    <input type="range" min="0" max="100" value="85" id="input-5" class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>

            <!-- Gauge (Reduced Height for Mobile) -->
            <div class="relative w-full h-[180px] md:h-[300px] flex justify-center items-center">
                <canvas id="vibeChart" class="max-h-full"></canvas>
                <div class="absolute top-[65%] left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
                    <p class="text-[9px] text-gray-500 uppercase tracking-[0.2em] mb-1 font-bold">Total Synergy</p>
                    <p id="vibe-score" class="text-5xl md:text-7xl font-title text-gold-bright font-bold drop-shadow-[0_0_30px_rgba(251,191,36,0.6)]">94%</p>
                </div>
            </div>
        </div>

        <div class="sticky-footer">
            <button onclick="nextSection('section-calc', 'section-studio')" class="btn-modern">
                Enter The Studio
            </button>
        </div>
    </div>

    <!-- SECTION 5: STUDIO & GIFT (MOBILE OPTIMIZED: FLOWER ON TOP) -->
    <div id="section-studio" class="section-container justify-center">
        
        <!-- Tabs -->
        <div class="flex space-x-12 mb-8 border-b border-white/5 pb-4 z-10 mt-10">
            <button onclick="switchTab('create')" id="tab-create" class="text-neon-blue font-ui tracking-[0.2em] text-[10px] font-bold border-b-2 border-neon-blue pb-2 transition-all">
                DIGITAL ROSE
            </button>
            <button onclick="switchTab('gift')" id="tab-gift" class="text-gray-500 hover:text-white font-ui tracking-[0.2em] text-[10px] font-bold border-b-2 border-transparent pb-2 transition-all">
                THE FINAL PART
            </button>
        </div>

        <div class="glass w-full max-w-4xl min-h-[550px] rounded-[40px] relative overflow-hidden flex flex-col justify-center items-center">
            
            <!-- PANEL 1: CREATOR (REVERSE LAYOUT FOR MOBILE) -->
            <div id="panel-create" class="w-full h-full flex flex-col-reverse md:flex-row gap-8 items-center justify-center fade-in p-6 md:p-10">
                
                <!-- Controls (Bottom on Phone) -->
                <div class="w-full md:w-1/3 space-y-6">
                    <h3 class="text-2xl font-title text-white">Electric Bloom</h3>
                    <p class="text-xs text-blue-300 font-ui italic leading-relaxed border-l-2 border-neon-blue pl-4 py-2 bg-blue-900/10 rounded-r-lg">
                        "I designed this one for you, but you can always customize it to your liking."
                    </p>
                    
                    <div>
                        <label class="text-[9px] uppercase text-gray-500 block mb-2 tracking-widest font-ui font-bold">Main Color</label>
                        <input type="color" id="color-core" value="#3b82f6" class="w-full h-10 rounded-xl cursor-pointer bg-transparent border border-white/10">
                    </div>
                    <div>
                        <label class="text-[9px] uppercase text-gray-500 block mb-2 tracking-widest font-ui font-bold">Highlight</label>
                        <input type="color" id="color-tip" value="#fbbf24" class="w-full h-10 rounded-xl cursor-pointer bg-transparent border border-white/10">
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="drawRose()" class="text-[9px] text-gray-400 uppercase tracking-widest hover:text-white transition-all border-b border-gray-700 hover:border-white pb-1 flex-1">Regenerate</button>
                        <button onclick="downloadRose()" class="flex-1 py-3 border border-neon-blue text-neon-blue hover:bg-neon-blue/10 rounded-full text-[9px] uppercase tracking-widest font-bold transition-all">
                            Download
                        </button>
                    </div>
                </div>

                <!-- Canvas (Top on Phone - Square) -->
                <div class="relative w-full aspect-square max-w-[300px] md:max-w-[450px] bg-black/60 border border-white/5 shadow-2xl rounded-3xl overflow-hidden flex items-center justify-center">
                    <canvas id="roseCanvas" class="w-full h-full"></canvas>
                </div>
            </div>

            <!-- PANEL 2: FINAL PART (Skinny Lock + Particles + Warm BG) -->
            <div id="panel-gift" class="hidden absolute inset-0 w-full h-full bg-void flex items-center justify-center overflow-hidden">
                
                <!-- Explosion Canvas -->
                <canvas id="explosionCanvas"></canvas>

                <!-- Content Behind Gates (Warm Galaxy) -->
                <div id="gift-content" class="text-center opacity-0 transition-opacity duration-1000 z-10 px-8 w-full h-full flex flex-col items-center justify-center bg-[radial-gradient(circle_at_center,_#4a0404_0%,_#000000_100%)]">
                    <div class="relative p-12 max-w-2xl">
                        <h2 class="text-4xl md:text-6xl font-title text-gold-bright mb-8 drop-shadow-[0_0_30px_#fbbf24] animate-pulse">My Heart is Yours</h2>
                        <p class="text-2xl md:text-3xl text-transparent bg-clip-text bg-gradient-to-r from-rose-300 via-white to-gold-200 font-hand leading-loose glow-text">
                            <!-- EDIT HERE: FINAL LETTER -->
                            "In a universe of chaos,<br>you are my gravity."
                        </p>
                        <div class="mt-12 text-6xl drop-shadow-[0_0_50px_#e11d48]">‚ù§Ô∏è</div>
                    </div>
                </div>

                <!-- The Gates -->
                <div id="gift-lock-layer" class="absolute inset-0 z-20 flex items-center justify-center bg-black">
                    <!-- Left Gate -->
                    <div class="gate-door left-door absolute left-0 top-0 w-1/2 h-full bg-[#050505] border-r border-gray-800"></div>
                    <!-- Right Gate -->
                    <div class="gate-door right-door absolute right-0 top-0 w-1/2 h-full bg-[#050505] border-l border-gray-800"></div>

                    <!-- Skinny Lock -->
                    <div id="lock-container" class="z-30 cursor-pointer flex flex-col items-center group transition-all duration-500" onclick="unlockGift()">
                         <div class="skinny-lock"></div>
                         <p class="mt-8 text-[9px] text-gray-500 tracking-[0.4em] uppercase font-bold group-hover:text-gold-bright transition-colors">Tap to Unlock</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- LOGIC -->
    <script>
        // --- 1. CAPTURE ---
        function captureCurrent() {
            const activeSection = document.querySelector('.section-container.active');
            if(activeSection) {
                const controls = document.querySelectorAll('.sticky-footer, .fixed');
                controls.forEach(c => c.style.opacity = '0');
                html2canvas(activeSection, { backgroundColor: '#020101' }).then(canvas => {
                    const link = document.createElement('a'); link.download = 'eternal-memory.png';
                    link.href = canvas.toDataURL(); link.click();
                    controls.forEach(c => c.style.opacity = '1');
                });
            }
        }

        // --- 2. NAVIGATION ---
        let currentChapter = 1;
        function nextSection(curr, next) {
            document.getElementById(curr).style.opacity = '0';
            setTimeout(() => {
                document.getElementById(curr).classList.remove('active');
                const nextEl = document.getElementById(next);
                nextEl.classList.add('active');
                
                if(next === 'section-game') startGameSetup();
                if(next === 'section-calc') initVibeChart();
                if(next === 'section-studio') {
                    // Delay rose drawing slightly to ensure layout is ready
                    setTimeout(drawRose, 100);
                }
                
                setTimeout(() => nextEl.style.opacity = '1', 50);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 800);
        }

        function revealNextChapter() {
            if(currentChapter < 5) {
                currentChapter++;
                const el = document.getElementById(`chap-${currentChapter}`);
                el.style.opacity = '1'; el.style.transform = 'translateY(0)';
                
                const progress = (currentChapter / 5) * 100;
                document.getElementById('timeline-progress').style.height = `${progress}%`;
                
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });

                if(currentChapter === 5) {
                    document.getElementById('btn-next-story').classList.add('hidden');
                    document.getElementById('btn-finish-story').classList.remove('hidden');
                }
            }
        }

        function switchTab(tab) {
            const createP = document.getElementById('panel-create'); const giftP = document.getElementById('panel-gift');
            const tabC = document.getElementById('tab-create'); const tabG = document.getElementById('tab-gift');
            
            if(tab === 'create') {
                createP.classList.remove('hidden'); createP.style.display = 'flex'; giftP.classList.add('hidden');
                tabC.classList.add('text-neon-blue', 'border-neon-blue'); tabC.classList.remove('text-gray-600', 'border-transparent');
                tabG.classList.remove('text-white', 'border-white'); tabG.classList.add('text-gray-600', 'border-transparent');
                setTimeout(drawRose, 50); // Redraw
            } else {
                createP.classList.add('hidden'); createP.style.display = 'none'; giftP.classList.remove('hidden');
                tabG.classList.add('text-white', 'border-white'); tabG.classList.remove('text-gray-600', 'border-transparent');
                tabC.classList.remove('text-neon-blue', 'border-neon-blue'); tabC.classList.add('text-gray-600', 'border-transparent');
            }
        }

        // --- 3. GAME ---
        const gameCanvas = document.getElementById('gameCanvas'); const gameCtx = gameCanvas.getContext('2d');
        let petals = []; let score = 0; let gameRunning = false; let loopId;
        const messages = ["Your laugh is my favorite song.", "You make the world feel softer.", "I love our late night talks.", "You are my safe space.", "Forever isn't long enough."];

        function startGameSetup() { const r = gameCanvas.parentElement.getBoundingClientRect(); gameCanvas.width = r.width; gameCanvas.height = r.height; }

        class GamePetal {
            constructor() { this.reset(); this.y = Math.random() * gameCanvas.height * -1; }
            reset() {
                this.x = Math.random() * gameCanvas.width; this.y = -50;
                this.size = Math.random() * 15 + 10; this.speed = Math.random() * 2 + 1;
                this.angle = Math.random() * Math.PI; this.spin = (Math.random()-0.5)*0.1;
            }
            update() {
                this.y += this.speed; this.x += Math.sin(this.y*0.02); this.angle += this.spin;
                if(this.y > gameCanvas.height+50) this.reset();
            }
            draw() {
                gameCtx.save(); gameCtx.translate(this.x, this.y); gameCtx.rotate(this.angle);
                gameCtx.beginPath();
                gameCtx.moveTo(0,0);
                gameCtx.bezierCurveTo(this.size, -this.size, this.size, this.size, 0, this.size*1.3);
                gameCtx.bezierCurveTo(-this.size, this.size, -this.size, -this.size, 0, 0);
                gameCtx.shadowBlur = 15; gameCtx.shadowColor = '#e11d48';
                const grad = gameCtx.createLinearGradient(-this.size, -this.size, this.size, this.size);
                grad.addColorStop(0, '#fbbf24'); grad.addColorStop(1, '#e11d48');
                gameCtx.fillStyle = grad; gameCtx.fill(); gameCtx.restore();
            }
        }

        function startGame() {
            document.getElementById('game-start-overlay').style.display = 'none';
            score = 0; petals = Array.from({length: 25}, () => new GamePetal());
            gameRunning = true; animateGame();
        }

        function animateGame() {
            if(!gameRunning) return;
            gameCtx.clearRect(0,0,gameCanvas.width, gameCanvas.height);
            petals.forEach(p => { p.update(); p.draw(); });
            loopId = requestAnimationFrame(animateGame);
        }

        gameCanvas.addEventListener('mousedown', e => handleInput(e.offsetX, e.offsetY));
        gameCanvas.addEventListener('touchstart', e => { e.preventDefault(); const r = gameCanvas.getBoundingClientRect(); handleInput(e.touches[0].clientX - r.left, e.touches[0].clientY - r.top); });

        function handleInput(x, y) {
            if(!gameRunning) return;
            for(let p of petals) { if(Math.hypot(x - p.x, y - p.y) < 40) { showMsg(); p.reset(); break; } }
        }

        function showMsg() {
            if(score >= messages.length) return;
            gameRunning = false; cancelAnimationFrame(loopId);
            document.getElementById('msg-id').innerText = score + 1;
            document.getElementById('msg-content').innerText = messages[score];
            document.getElementById('msg-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('modal-card').classList.add('show'), 10);
            score++; document.getElementById('score').innerText = score;
        }

        function closeModal() {
            document.getElementById('modal-card').classList.remove('show');
            setTimeout(() => document.getElementById('msg-modal').classList.add('hidden'), 300);
            if(score < messages.length) { gameRunning = true; animateGame(); }
            else { gameCtx.clearRect(0,0,gameCanvas.width, gameCanvas.height); const nextBtn = document.getElementById('game-next-btn'); nextBtn.classList.remove('hidden'); setTimeout(() => nextBtn.style.opacity = '1', 100); }
        }

        // --- 4. CALCULATOR ---
        let vibeChart;
        function initVibeChart() {
            const ctx = document.getElementById('vibeChart').getContext('2d');
            vibeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Synergy', 'Void'],
                    datasets: [{ data: [94, 6], backgroundColor: ['#fbbf24', '#2a0a0a'], borderWidth: 0, circumference: 180, rotation: 270 }]
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '90%', plugins: { legend: { display: false }, tooltip: { enabled: false } } }
            });
            updateVibe();
        }
        function updateVibe() {
            let total = 0;
            for(let i=1; i<=5; i++) {
                const val = parseInt(document.getElementById(`input-${i}`).value);
                document.getElementById(`val-${i}`).innerText = val + '%'; total += val;
            }
            const avg = Math.round(total/5);
            document.getElementById('vibe-score').innerText = avg + '%';
            vibeChart.data.datasets[0].data = [avg, 100-avg]; vibeChart.update();
        }
        for(let i=1; i<=5; i++) document.getElementById(`input-${i}`).addEventListener('input', updateVibe);

        // --- 5. ROSE STUDIO (USER CODE INSERTED & SCALED) ---
        const rC = document.getElementById('roseCanvas'); const rCtx = rC.getContext('2d');
        function drawRose() {
            const rect = rC.parentElement.getBoundingClientRect(); 
            // Force Square Aspect Ratio based on container width
            rC.width = rect.width; 
            rC.height = rect.width; 
            
            const w = rC.width; const h = rC.height; const cx = w/2; const cy = h/2;
            const cCore = document.getElementById('color-core').value;
            const cTip = document.getElementById('color-tip').value;
            
            rCtx.clearRect(0,0,w,h); rCtx.globalCompositeOperation = 'source-over';
            
            // Scaling logic to make sure user's code fits in the canvas
            // The user's code uses fixed values (20, 15), we scale them relative to canvas width
            const scale = w / 400; 

            for(let i=0; i<60; i++) {
                const angle = i * 137.5 * (Math.PI/180);
                const r = (20 * Math.sqrt(i) * 0.8) * scale * 5; // Scaled R
                const x = cx + r * Math.cos(angle); const y = cy + r * Math.sin(angle);
                const size = ((i * 0.8) + 15) * scale * 1.5; // Scaled Size
                
                rCtx.save(); rCtx.translate(x, y); rCtx.rotate(angle);
                rCtx.beginPath();
                rCtx.moveTo(0,0);
                rCtx.bezierCurveTo(size, -size/2, size, size/2, 0, size);
                rCtx.bezierCurveTo(-size, size/2, -size, -size/2, 0, 0);
                
                const grad = rCtx.createRadialGradient(0,0,0, 0,0, size);
                grad.addColorStop(0, cCore); grad.addColorStop(1, cTip);
                rCtx.fillStyle = grad; rCtx.globalAlpha = 0.8; rCtx.fill(); rCtx.restore();
            }
        }
        document.getElementById('color-core').addEventListener('input', drawRose);
        document.getElementById('color-tip').addEventListener('input', drawRose);
        function downloadRose() { const a = document.createElement('a'); a.download = 'my-art-rose.png'; a.href = rC.toDataURL(); a.click(); }

        // --- 6. UNLOCK EXPLOSION ---
        const expC = document.getElementById('explosionCanvas');
        const expCtx = expC.getContext('2d');
        let particles = [];

        function unlockGift() {
            const lock = document.getElementById('lock-container');
            const layer = document.getElementById('gift-lock-layer');
            const content = document.getElementById('gift-content');
            
            lock.classList.add('unlocking');
            
            setTimeout(() => {
                expC.width = window.innerWidth; expC.height = window.innerHeight;
                for(let i=0; i<300; i++) {
                    particles.push({
                        x: expC.width/2, y: expC.height/2,
                        vx: (Math.random()-0.5)*30, vy: (Math.random()-0.5)*30,
                        life: 1, color: Math.random()>0.5 ? '#fbbf24' : '#e11d48'
                    });
                }
                animateExplosion();
                layer.classList.add('gate-open');
                setTimeout(() => { layer.style.opacity = '0'; layer.style.pointerEvents = 'none'; content.style.opacity = '1'; }, 1000);
            }, 600);
        }

        function animateExplosion() {
            if(particles.length === 0) return;
            expCtx.clearRect(0,0,expC.width, expC.height);
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.01;
                if(p.life <= 0) particles.splice(i, 1);
                expCtx.globalAlpha = p.life; expCtx.fillStyle = p.color;
                expCtx.beginPath(); expCtx.arc(p.x, p.y, Math.random()*3+1, 0, Math.PI*2); expCtx.fill();
            });
            requestAnimationFrame(animateExplosion);
        }

        // --- BACKGROUND ---
        const bgC = document.getElementById('bgCanvas'); const bgCtx = bgC.getContext('2d');
        let bgParts = [];
        function initBg() { bgC.width = window.innerWidth; bgC.height = window.innerHeight; bgParts = Array.from({length:60},()=>({x:Math.random()*bgC.width,y:Math.random()*bgC.height,s:Math.random()*2,sp:Math.random()*0.5+0.1})); animateBg(); }
        function animateBg() {
            bgCtx.clearRect(0,0,bgC.width, bgC.height); bgCtx.fillStyle = '#b45309';
            bgParts.forEach(p=>{ p.y-=p.sp; if(p.y<0)p.y=bgC.height; bgCtx.globalAlpha=Math.random()*0.5+0.2; bgCtx.beginPath();bgCtx.arc(p.x,p.y,p.s,0,Math.PI*2);bgCtx.fill(); });
            requestAnimationFrame(animateBg);
        }
        window.addEventListener('resize', initBg); initBg();

    </script>
</body>
</html>
